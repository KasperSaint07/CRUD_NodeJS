<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple Blog CRUD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #f4f5f7;
        color: #333;
      }
      header {
        background: #1f2933;
        color: #fff;
        padding: 1rem 2rem;
        text-align: center;
      }
      main {
        max-width: 900px;
        margin: 1.5rem auto;
        padding: 0 1rem 2rem;
      }
      h1,
      h2 {
        margin: 0 0 1rem;
      }
      .card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(15, 23, 42, 0.1);
        padding: 1.25rem;
        margin-bottom: 1.5rem;
      }
      label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
        font-weight: 600;
      }
      input[type='text'],
      textarea {
        width: 100%;
        padding: 0.6rem 0.75rem;
        margin-bottom: 0.75rem;
        border-radius: 6px;
        border: 1px solid #d0d7e2;
        font-size: 0.95rem;
        resize: vertical;
      }
      textarea {
        min-height: 80px;
      }
      .btn {
        display: inline-block;
        border: none;
        border-radius: 6px;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        cursor: pointer;
        margin-right: 0.5rem;
        margin-top: 0.25rem;
        transition: background 0.15s ease, transform 0.05s ease;
      }
      .btn-primary {
        background: #2563eb;
        color: #fff;
      }
      .btn-primary:hover {
        background: #1d4ed8;
      }
      .btn-secondary {
        background: #e5e7eb;
        color: #111827;
      }
      .btn-secondary:hover {
        background: #d1d5db;
      }
      .btn-danger {
        background: #dc2626;
        color: #fff;
      }
      .btn-danger:hover {
        background: #b91c1c;
      }
      .btn:active {
        transform: translateY(1px);
      }
      .blog-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 1rem;
      }
      .blog-item {
        background: #ffffff;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 2px 5px rgba(15, 23, 42, 0.08);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .blog-title {
        font-weight: 700;
        margin-bottom: 0.35rem;
      }
      .blog-meta {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 0.5rem;
      }
      .blog-body {
        font-size: 0.9rem;
        margin-bottom: 0.75rem;
      }
      .blog-actions {
        margin-top: auto;
      }
      .status {
        font-size: 0.85rem;
        margin-bottom: 0.75rem;
        color: #374151;
      }
      .status-error {
        color: #b91c1c;
      }
      .status-success {
        color: #15803d;
      }
      .id-input {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 0.5rem;
      }
      .id-input input[type='text'] {
        flex: 1;
        min-width: 200px;
        margin-bottom: 0;
      }
      @media (max-width: 600px) {
        header {
          padding: 0.75rem 1rem;
        }
        main {
          padding: 0 0.75rem 1.5rem;
        }
        .card {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Blog API â€“ Simple CRUD Interface</h1>
    </header>
    <main>
      <section class="card">
        <h2>Create / Update Blog Post</h2>
        <div class="status" id="formStatus"></div>
        <form id="blogForm">
          <div class="id-input">
            <input
              type="text"
              id="blogId"
              placeholder="Blog ID (for update only, leave empty to create)"
            />
            <button type="button" class="btn btn-secondary" id="loadByIdBtn">
              Load by ID
            </button>
          </div>
          <label for="title">Title *</label>
          <input type="text" id="title" required />

          <label for="body">Body *</label>
          <textarea id="body" required></textarea>

          <label for="author">Author (optional)</label>
          <input type="text" id="author" placeholder="Anonymous" />

          <button type="submit" class="btn btn-primary">Save Post</button>
          <button type="button" class="btn btn-secondary" id="resetFormBtn">
            Clear Form
          </button>
        </form>
      </section>

      <section class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2>All Blog Posts</h2>
          <button class="btn btn-secondary" id="refreshBtn">Refresh</button>
        </div>
        <div class="status" id="listStatus"></div>
        <div id="blogList" class="blog-list"></div>
      </section>
    </main>

    <script>
      const apiBase = '';

      const blogForm = document.getElementById('blogForm');
      const blogIdInput = document.getElementById('blogId');
      const titleInput = document.getElementById('title');
      const bodyInput = document.getElementById('body');
      const authorInput = document.getElementById('author');
      const formStatus = document.getElementById('formStatus');
      const blogList = document.getElementById('blogList');
      const listStatus = document.getElementById('listStatus');
      const refreshBtn = document.getElementById('refreshBtn');
      const resetFormBtn = document.getElementById('resetFormBtn');
      const loadByIdBtn = document.getElementById('loadByIdBtn');

      function setStatus(element, message, type = '') {
        element.textContent = message || '';
        element.classList.remove('status-error', 'status-success');
        if (type === 'error') {
          element.classList.add('status-error');
        } else if (type === 'success') {
          element.classList.add('status-success');
        }
      }

      function clearForm() {
        blogIdInput.value = '';
        titleInput.value = '';
        bodyInput.value = '';
        authorInput.value = '';
        setStatus(formStatus, '');
      }

      async function fetchBlogs() {
        setStatus(listStatus, 'Loading posts...');
        blogList.innerHTML = '';
        try {
          const res = await fetch(apiBase + '/blogs');
          if (!res.ok) {
            throw new Error('Failed to load blogs');
          }
          const data = await res.json();
          if (!Array.isArray(data) || data.length === 0) {
            blogList.innerHTML = '<p>No posts yet. Create one above!</p>';
            setStatus(listStatus, 'Loaded (0 posts)', 'success');
            return;
          }
          data.forEach((blog) => {
            const div = document.createElement('div');
            div.className = 'blog-item';
            const created = blog.createdAt
              ? new Date(blog.createdAt).toLocaleString()
              : '';
            const updated = blog.updatedAt
              ? new Date(blog.updatedAt).toLocaleString()
              : '';
            div.innerHTML = `
              <div>
                <div class="blog-title">${blog.title}</div>
                <div class="blog-meta">
                  ID: ${blog._id}<br />
                  Author: ${blog.author || 'Anonymous'}<br />
                  Created: ${created}<br />
                  Updated: ${updated}
                </div>
                <div class="blog-body">${blog.body}</div>
              </div>
              <div class="blog-actions">
                <button class="btn btn-secondary btn-sm" data-id="${blog._id}" data-action="edit">Edit</button>
                <button class="btn btn-danger btn-sm" data-id="${blog._id}" data-action="delete">Delete</button>
              </div>
            `;
            blogList.appendChild(div);
          });
          setStatus(listStatus, 'Posts loaded successfully', 'success');
        } catch (err) {
          console.error(err);
          setStatus(listStatus, 'Error loading posts', 'error');
        }
      }

      blogForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const title = titleInput.value.trim();
        const body = bodyInput.value.trim();
        const author = authorInput.value.trim();
        const id = blogIdInput.value.trim();

        if (!title || !body) {
          setStatus(formStatus, 'Title and body are required', 'error');
          return;
        }

        const payload = { title, body };
        if (author) payload.author = author;

        try {
          setStatus(formStatus, 'Saving...');
          const method = id ? 'PUT' : 'POST';
          const url = id ? apiBase + '/blogs/' + id : apiBase + '/blogs';
          const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok) {
            const msg = data.message || 'Request failed';
            throw new Error(msg);
          }

          setStatus(
            formStatus,
            id ? 'Post updated successfully' : 'Post created successfully',
            'success'
          );
          await fetchBlogs();
          if (!id) {
            clearForm();
          } else {
            blogIdInput.value = data._id || id;
          }
        } catch (err) {
          console.error(err);
          setStatus(formStatus, err.message || 'Error saving post', 'error');
        }
      });

      blogList.addEventListener('click', async (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const id = btn.getAttribute('data-id');
        const action = btn.getAttribute('data-action');

        if (action === 'edit') {
          try {
            setStatus(formStatus, 'Loading post...');
            const res = await fetch(apiBase + '/blogs/' + id);
            const data = await res.json();
            if (!res.ok) throw new Error(data.message || 'Failed to load');
            blogIdInput.value = data._id;
            titleInput.value = data.title || '';
            bodyInput.value = data.body || '';
            authorInput.value = data.author || '';
            setStatus(formStatus, 'Post loaded into form', 'success');
            window.scrollTo({ top: 0, behavior: 'smooth' });
          } catch (err) {
            console.error(err);
            setStatus(formStatus, 'Error loading post', 'error');
          }
        } else if (action === 'delete') {
          if (!confirm('Are you sure you want to delete this post?')) return;
          try {
            const res = await fetch(apiBase + '/blogs/' + id, {
              method: 'DELETE',
            });
            const data = await res.json().catch(() => ({}));
            if (!res.ok) {
              const msg = data.message || 'Delete failed';
              throw new Error(msg);
            }
            setStatus(listStatus, 'Post deleted', 'success');
            if (blogIdInput.value === id) {
              clearForm();
            }
            await fetchBlogs();
          } catch (err) {
            console.error(err);
            setStatus(listStatus, err.message || 'Error deleting post', 'error');
          }
        }
      });

      refreshBtn.addEventListener('click', fetchBlogs);
      resetFormBtn.addEventListener('click', clearForm);

      loadByIdBtn.addEventListener('click', async () => {
        const id = blogIdInput.value.trim();
        if (!id) {
          setStatus(formStatus, 'Enter an ID to load', 'error');
          return;
        }
        try {
          setStatus(formStatus, 'Loading post...');
          const res = await fetch(apiBase + '/blogs/' + id);
          const data = await res.json();
          if (!res.ok) throw new Error(data.message || 'Failed to load');
          titleInput.value = data.title || '';
          bodyInput.value = data.body || '';
          authorInput.value = data.author || '';
          setStatus(formStatus, 'Post loaded into form', 'success');
        } catch (err) {
          console.error(err);
          setStatus(formStatus, 'Error loading post by ID', 'error');
        }
      });

      fetchBlogs();
    </script>
  </body>
  </html>


